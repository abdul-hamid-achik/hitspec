{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "hitspec",
  "scopeName": "source.hitspec",
  "patterns": [
    { "include": "#comments" },
    { "include": "#separators" },
    { "include": "#annotations" },
    { "include": "#variables" },
    { "include": "#methods" },
    { "include": "#headers" },
    { "include": "#assertions" },
    { "include": "#captures" },
    { "include": "#strings" },
    { "include": "#numbers" },
    { "include": "#operators" },
    { "include": "#functions" },
    { "include": "#interpolation" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.number-sign.hitspec",
          "match": "^#(?!\\s*@).*$"
        }
      ]
    },
    "separators": {
      "patterns": [
        {
          "name": "markup.heading.hitspec",
          "match": "^###.*$"
        }
      ]
    },
    "annotations": {
      "patterns": [
        {
          "name": "entity.name.tag.hitspec",
          "match": "^#\\s*@(name|description|tags|skip|only|timeout|retry|retryDelay|depends|auth|before|after|db|waitfor|stress\\.\\w+|contract\\.\\w+|x-\\w+)\\b",
          "captures": {
            "1": { "name": "keyword.other.annotation.hitspec" }
          }
        }
      ]
    },
    "variables": {
      "patterns": [
        {
          "name": "variable.other.hitspec",
          "match": "^@[a-zA-Z_][a-zA-Z0-9_]*\\s*=",
          "captures": {
            "0": { "name": "variable.other.assignment.hitspec" }
          }
        }
      ]
    },
    "methods": {
      "patterns": [
        {
          "name": "keyword.other.method.hitspec",
          "match": "^(GET|POST|PUT|PATCH|DELETE|HEAD|OPTIONS|TRACE|CONNECT)\\b"
        }
      ]
    },
    "headers": {
      "patterns": [
        {
          "name": "entity.name.tag.header.hitspec",
          "match": "^([A-Za-z][A-Za-z0-9-]*)(:)",
          "captures": {
            "1": { "name": "entity.name.tag.header-name.hitspec" },
            "2": { "name": "punctuation.separator.key-value.hitspec" }
          }
        }
      ]
    },
    "assertions": {
      "patterns": [
        {
          "name": "meta.assertion.hitspec",
          "begin": "^>>>",
          "end": "^<<<",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.assertion.begin.hitspec" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.assertion.end.hitspec" }
          },
          "patterns": [
            {
              "name": "keyword.control.expect.hitspec",
              "match": "\\bexpect\\b"
            },
            {
              "name": "keyword.operator.comparison.hitspec",
              "match": "\\b(==|!=|>=|<=|>|<|contains|!contains|startsWith|endsWith|matches|exists|!exists|length|includes|!includes|in|!in|type|each|schema|snapshot)\\b"
            },
            {
              "name": "variable.other.subject.hitspec",
              "match": "\\b(status|duration|body|header|p50|p95|p99)\\b"
            },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#interpolation" }
          ]
        }
      ]
    },
    "captures": {
      "patterns": [
        {
          "name": "meta.capture.hitspec",
          "begin": "^\\[\\[\\[",
          "end": "^\\]\\]\\]",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.capture.begin.hitspec" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.capture.end.hitspec" }
          },
          "patterns": [
            {
              "name": "keyword.control.from.hitspec",
              "match": "\\bfrom\\b"
            },
            { "include": "#strings" },
            { "include": "#interpolation" }
          ]
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.hitspec",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "include": "#interpolation" },
            {
              "name": "constant.character.escape.hitspec",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.hitspec",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "include": "#interpolation" }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.hitspec",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.hitspec",
          "match": "(==|!=|>=|<=|>|<|=)"
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "support.function.builtin.hitspec",
          "match": "\\$(?:uuid|timestamp|random|randomInt|randomString|randomEmail|randomName|env|file|base64|md5|sha256|now|dateFormat|urlEncode|urlDecode|jsonPath|xpath|lower|upper|trim|replace|split|join|length|slice|first|last|nth|sum|avg|min|max|count|sort|reverse|unique|filter|map|reduce|find|some|every|flatten|merge|keys|values|entries|fromEntries|pick|omit|get|set|has|delete|typeof|isNull|isNumber|isString|isArray|isObject|isEmpty|isTruthy|default|coalesce|if|switch|range|repeat|concat|pad|padStart|padEnd|truncate|escape|unescape|stringify|parse|format|match|test|exec|groups|index|lastIndex|startsWith|endsWith|includes|indexOf|lastIndexOf|charAt|charCodeAt|codePointAt|normalize|localeCompare|toLocaleLowerCase|toLocaleUpperCase|substring|substr|slice|split|repeat|trimStart|trimEnd|valueOf|toString)\\b"
        }
      ]
    },
    "interpolation": {
      "patterns": [
        {
          "name": "meta.interpolation.hitspec",
          "begin": "\\{\\{",
          "end": "\\}\\}",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.interpolation.begin.hitspec" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.interpolation.end.hitspec" }
          },
          "patterns": [
            { "include": "#functions" },
            {
              "name": "variable.other.interpolation.hitspec",
              "match": "[a-zA-Z_][a-zA-Z0-9_\\.]*"
            }
          ]
        }
      ]
    }
  }
}
